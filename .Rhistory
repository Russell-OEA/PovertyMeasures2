install.packages("BCA")
install.packages("tidyverse")
install.packages(c("backports", "BH", "blob", "boot", "broom", "car", "carData", "class", "cli", "clipr", "cluster", "codetools", "colorspace", "conquer", "crayon", "curl", "data.table", "DBI", "desc", "digest", "dplyr", "dtplyr", "e1071", "effects", "evaluate", "fansi", "farver", "foreign", "Formula", "fs", "generics", "glue", "haven", "highr", "Hmisc", "htmlTable", "htmltools", "htmlwidgets", "insight", "isoband", "jpeg", "jrvFinance", "jsonlite", "KernSmooth", "knitr", "labeling", "lattice", "lme4", "magrittr", "maptools", "MASS", "Matrix", "MatrixModels", "matrixStats", "mgcv", "mime", "nlme", "nloptr", "nnet", "openssl", "openxlsx", "pbkrtest", "pillar", "pkgbuild", "pkgload", "ps", "quantreg", "R6", "Rcmdr", "RcmdrMisc", "Rcpp", "RcppArmadillo", "RcppEigen", "readr", "readstata13", "rio", "rlang", "rmarkdown", "rpart", "rprojroot", "sandwich", "sp", "SparseM", "spatial", "stargazer", "statmod", "stringi", "survey", "survival", "testthat", "tidyr", "tidyselect", "tinytex", "utf8", "uuid", "viridis", "viridisLite", "withr", "xfun", "xml2", "yaml", "zip", "zoo"))
library(tidycensus)
library(tidycensus)
install.packages('devtools') #assuming it is not already installed
library(devtools)
install_github('andreacirilloac/updateR')
library(updateR)
updateR(admin_password = 'Admin user password')
updateR()
library(tidycensus)
install(rgdal)
install.packages("rgdal")
install(rgdal)
library(tidycensus)
install(tidycensus)
install.packages("tidycensus")
library(tidycensus)
install.packages("tidycensus")
install.packages("tidycensus")
library(tidycensus)
library(tidycensus)
census_api_key("0fb1cd3d58bf3205c4d8b4d673a4c186e57ea875", install = TRUE)
library(tidycensus)
install.packages("tidycensus")
library(tidycensus)
library(tidycensus)
install.package("rgdal")
install.packages("rgdal")
library(tidycensus)
library(tidycensus)
library(tidyverse)
install.packages("tidyverse")
library(tidyverse)
library(tidyselect)
detach("package:tidyselect", unload = TRUE)
library(tidycensus)
detach("package:tidycensus", unload = TRUE)
library(tidycensus)
detach("package:tidycensus", unload = TRUE)
library(tidyverse)
library(tidycensus)
install.packages(c("rgdal", "tidycensus"))
library(tidycensus)
module purge
install.packages(c('rgdal'),repos = "http://cran.case.edu", configure.args=c("--with-proj-include=/packages/PROJ/6.1.0/include","--with-proj-lib=/packages/PROJ/6.1.0/lib"))
library(tidyverse)
library(tidycensus)
census_api_key("0fb1cd3d58bf3205c4d8b4d673a4c186e57ea875", install = TRUE)
total_population_10 <- get_decennial(
geography = "state",
variables = "P001001",
year = 2010
)
census_api_key("0fb1cd3d58bf3205c4d8b4d673a4c186e57ea875", install = TRUE)
total_population_10 <- get_decennial(
geography = "state",
variables = "P001001",
year = 2010
)
census_api_key("0fb1cd3d58bf3205c4d8b4d673a4c186e57ea875")
total_population_10 <- get_decennial(
geography = "state",
variables = "P001001",
year = 2010
)
View(total_population_10)
View(total_population_10)
total_population_10 <- get_decennial(
geography = "census block",
variables = "P001001",
year = 2010,
state = "NJ"
)
total_population_10 <- get_decennial(
geography = "block",
variables = "P001001",
year = 2010,
state = "NJ"
)
View(total_population_10)
v17 <- load_variables(2020, "pl", cache = TRUE)
View(v17)
total_population_20 <- get_decennial(
geography = "block",
variables = "P001001",
year = 2020,
state = "NJ"
)
total_population_20 <- get_decennial(
geography = "block",
variables = "P1_001",
year = 2020,
state = "NJ"
)
v18 <- load_variables(2010, "pl", cache = TRUE)
View(v18)
total_population_20 <- get_decennial(
geography = "block",
variables = "P1_001N",
year = 2020,
state = "NJ"
)
setwd("~/Documents/GitHub/PovertyMeasures2")
source("Revised_Water_System_Code_05162022.R")
county_display_filter_variables <- c(
"Muni",
"MHI_Percent_State",
"ANN_AV_UNEMP_RATE",
"PopChange_Value",
"Adjusted_Score"
)
table.Hunterdon <- Poverty_Data_Final %>%
filter(County == "Hunterdon") %>%
select(county_display_filter_variables)
View(table.Hunterdon)
col.names <- c("Name","MHI Percent", "Unemployment Rate", "Population Change", "Adjusted Score")
table.Hunterdon <- Poverty_Data_Final %>%
filter(County == "Hunterdon") %>%
select(county_display_filter_variables)
column_names_external <- c("Name","MHI Percent", "Unemployment Rate", "Population Change", "Adjusted Score")
table.Hunterdon_External <- Poverty_Data_Final %>%
filter(County == "Hunterdon") %>%
select(county_display_filter_variables)
kable(table.Hunterdon_external, col.names = column_names_external)
kable(table.Hunterdon_external, col.names = column_names_external)
table.Hunterdon_external <- Poverty_Data_Final %>%
filter(County == "Hunterdon") %>%
select(county_display_filter_variables)
kable(table.Hunterdon_external, col.names = column_names_external)
column_names_external <- c("Name","MHI Percent", "Unemp Rate", "Population Change", "Adjusted Score")
View(Poverty_data)
View(NJ_County_Unemp)
table.Atlantic_external <- Poverty_Data_Final %>%
filter(County == "Atlantic") %>%
select(county_display_filter_variables)
table.Bergen_external <- Poverty_Data_Final %>%
filter(County == "Bergen") %>%
select(county_display_filter_variables)
table.Burlington_external <- Poverty_Data_Final %>%
filter(County == "Burlington") %>%
select(county_display_filter_variables)
table.Camden_external <- Poverty_Data_Final %>%
filter(County == "Camden") %>%
select(county_display_filter_variables)
table.Cape_May_external <- Poverty_Data_Final %>%
filter(County == "Cape May") %>%
select(county_display_filter_variables)
table.Cumberland_external <- Poverty_Data_Final %>%
filter(County == "Cumberland") %>%
select(county_display_filter_variables)
table.Essex_external <- Poverty_Data_Final %>%
filter(County == "Essex") %>%
select(county_display_filter_variables)
View(table.Cape_May_external)
table.Gloucester_external <- Poverty_Data_Final %>%
filter(County == "Gloucester") %>%
select(county_display_filter_variables)
table.Hudson_external <- Poverty_Data_Final %>%
filter(County == "Hudson") %>%
select(county_display_filter_variables)
View(table.Hudson_external)
table.Mercer_external <- Poverty_Data_Final %>%
filter(County == "Mercer") %>%
select(county_display_filter_variables)
table.Middlesex_external <- Poverty_Data_Final %>%
filter(County == "Middlesex") %>%
select(county_display_filter_variables)
table.Monmouth_external <- Poverty_Data_Final %>%
filter(County == "Monmouth") %>%
select(county_display_filter_variables)
table.Morris_external <- Poverty_Data_Final %>%
filter(County == "Morris") %>%
select(county_display_filter_variables)
county_display_filter_variables <- c(
"Muni",
"MHI_Percent_State",
"ANN_AV_UNEMP_RATE",
"PopChange_Value",
"Adjusted_Score"
)
column_names_external <- c("Name","MHI Percent", "Unemp Rate", "Population Change", "Adjusted Score")
table.Atlantic_external <- Poverty_Data_Final %>%
filter(County == "Atlantic") %>%
select(county_display_filter_variables)
table.Bergen_external <- Poverty_Data_Final %>%
filter(County == "Bergen") %>%
select(county_display_filter_variables)
table.Burlington_external <- Poverty_Data_Final %>%
filter(County == "Burlington") %>%
select(county_display_filter_variables)
table.Camden_external <- Poverty_Data_Final %>%
filter(County == "Camden") %>%
select(county_display_filter_variables)
table.Cape_May_external <- Poverty_Data_Final %>%
filter(County == "Cape May") %>%
select(county_display_filter_variables)
table.Cumberland_external <- Poverty_Data_Final %>%
filter(County == "Cumberland") %>%
select(county_display_filter_variables)
table.Essex_external <- Poverty_Data_Final %>%
filter(County == "Essex") %>%
select(county_display_filter_variables)
table.Gloucester_external <- Poverty_Data_Final %>%
filter(County == "Gloucester") %>%
select(county_display_filter_variables)
table.Hudson_external <- Poverty_Data_Final %>%
filter(County == "Hudson") %>%
select(county_display_filter_variables)
table.Hunterdon_external <- Poverty_Data_Final %>%
filter(County == "Hunterdon") %>%
select(county_display_filter_variables)
table.Mercer_external <- Poverty_Data_Final %>%
filter(County == "Mercer") %>%
select(county_display_filter_variables)
table.Middlesex_external <- Poverty_Data_Final %>%
filter(County == "Middlesex") %>%
select(county_display_filter_variables)
table.Monmouth_external <- Poverty_Data_Final %>%
filter(County == "Monmouth") %>%
select(county_display_filter_variables)
table.Morris_external <- Poverty_Data_Final %>%
filter(County == "Morris") %>%
select(county_display_filter_variables)
table.Ocean_external <- Poverty_Data_Final %>%
filter(County == "Ocean") %>%
select(county_display_filter_variables)
table.Passaic_external <- Poverty_Data_Final %>%
filter(County == "Passaic") %>%
select(county_display_filter_variables)
table.Somerset_external <- Poverty_Data_Final %>%
filter(County == "Somerset") %>%
select(county_display_filter_variables)
table.Salem_external <- Poverty_Data_Final %>%
filter(County == "Salem") %>%
select(county_display_filter_variables)
table.Sussex_external <- Poverty_Data_Final %>%
filter(County == "Sussex") %>%
select(county_display_filter_variables)
table.Union_external <- Poverty_Data_Final %>%
filter(County == "Union") %>%
select(county_display_filter_variables)
table.Warren_external <- Poverty_Data_Final %>%
filter(County == "Warren") %>%
select(county_display_filter_variables)
kable(table.Hunterdon_external, col.names = column_names_external)
source("External_Tables.R")
The municipal median household income (MHI) as a percent of New Jersey's MHI, rounded to the nearest hundredth. Municipal values used are those found in the 2020 Municipal Revitalization Index. These values represent the MHI in 2019 as provided by the Department of Community Affairs. The statewide MHI used in the comparison was $'NJ_MHI'
# Calculates lists of communities meeting different affordable thresholds -----
# Project for water group
# Last Updated: 05/16/2022
# Contact: Mike Russell, Michael.Russell@dep.nj.gov
# Load packages -----
library(tidyverse)
library(readr)
library(readxl)
library(knitr)
library(ezknitr)
# Importing Data -----
## MRI -----
# MRI data has municipal unemployment and population change
# Future versions of this analysis will pull from ACS directly
### Create column names for MRI dataset -----
# This helps with importing the MRI data
MRI_columns <- c("CODE",
"Muni",
"County",
"Region",
"MRI_Score",
"MRI_Distress",
"MRI_Rank",
"PopChange_Rank",
"PopChange_Index",
"PopChange_Value",
"HousingVacancy_Rank",
"HousingVacancy_Index",
"HousingVacancy_Value",
"SNAPPercent_Rank",
"SNAPPercent_Index",
"SNAPPercent_Value",
"TANFRate_Rank",
"TANFRate_Index",
"TANFRate_Value",
"PovertyRate_Rank",
"PovertyRate_Index",
"PovertyRate_Value",
"MHI_Rank",
"MHI_Index",
"MHI_Value",
"Unemp_Rank",
"Unemp_Index",
"Unemp_Value",
"HSDiploma_Rank",
"HSDiploma_Index",
"HSDiploma_Value",
"PropTaxRate_Rank",
"PropTaxRate_Index",
"PropTaxRate_Value",
"PerCapitaValuation_Rank",
"PerCapitaValuation_Index",
"PerCapitaValuation_Value",
"Urban_Aid")
### Import MRI dataset: -----
# Source: https://www.nj.gov/dca/home/MuniRevitIndex.html
MRI_data <- read_excel("2020_MRI_Scores_and_Rankings.xlsx", # imports file
sheet = "2020 MRI - Alphabetical", # selects correct Excel worksheet
col_types = c("text", "text", "text", # sets value columns to numeric, ignore errors
"text", "text", "text", "text", "text",
"text", "numeric", "text", "text",
"numeric", "text", "text", "numeric",
"text", "text", "numeric", "text",
"text", "numeric", "text", "text",
"numeric", "text", "text", "numeric",
"text", "text", "numeric", "text",
"text", "numeric", "text", "text",
"numeric", "text"),
col_names = MRI_columns) # names columns
remove(MRI_columns) # removes column names from working environment after they've been added to the table
### State Average ----
NJ_State_Pop <- -0.03
## Unemployment -----
### County Unemployment Rates -----
# Using 2019 data to avoid pandemic-related distortion
# Source: https://www.nj.gov/labor/lpa/employ/uirate/fmth_2010-2020.xlsx
NJ_County_Unemp <- read_csv("NJ_County_Unemp_2019.csv",
col_types = cols(CNTY = col_character()))
### State Unemployment Rate -----
NJ_State_Unemp <- 3.4
## OBC / Poverty -----
### Data for OBC-style metric at community level -----
# Source: Census
# CSV available at: https://censusreporter.org/data/table/?table=C17002&geo_ids=04000US34,310|04000US34,060|04000US34&primary_geo_id=04000US34#
EJ_Def_Data <- read_csv("ACS_Poverty_Measures_EJ_Def.csv")
## NJ State Municipal Code - FIPS Code Crosswalk -----
# Simple crosswalk table to allow merging later
Muni_Code_Crosswalk <- read_csv("Muni_Code_Crosswalk.csv")
## NJ Statewide MHI -----
# Source: https://www.census.gov/quickfacts/NJ
NJ_MHI <- 85245
# Cleaning Data -----
## MRI -----
MRI_data <-
MRI_data %>%
filter(!is.na(CODE)) %>% # Removes extra header rows, layout rows, etc. from Excel sheet
select(CODE, Muni, County, Region, MRI_Score, MRI_Rank, PopChange_Value, PovertyRate_Value, MHI_Value, Unemp_Value) # removes all but the selected columns
MRI_data$PopChange_Value <- MRI_data$PopChange_Value * 100 # Converts rate from decimal to percent value to make comparison easier
MRI_data$PopChange_Value <- round(MRI_data$PopChange_Value, 2) # rounds for easy comparison
MRI_data$NJ_State_Pop <- NJ_State_Pop # adds state pop change for comparison below
MRI_data$PopChange_Diff <- MRI_data$PopChange_Value - MRI_data$NJ_State_Pop # compares muni to state average
MRI_data$PovertyRate_Value <- MRI_data$PovertyRate_Value * 100 # percent conversion
MRI_data$Unemp_Value <- MRI_data$Unemp_Value * 100 # percent conversion
## Unemployment -----
NJ_County_Unemp$NJ_State_Unemp <- NJ_State_Unemp # adds column for statewide average for comparison
NJ_County_Unemp$Unemp_Diff <- NJ_County_Unemp$ANN_AV_UNEMP_RATE - NJ_County_Unemp$NJ_State_Unemp # compares muni to state average
## OBC -----
# The process below is essentially the same as described here: https://www.nj.gov/dep/ej/docs/obc-technical-document.pdf
EJ_Def_Data <-
EJ_Def_Data %>%
dplyr::filter(!grepl('31000|04000',geoid)) %>% #remove state and MSA values, leave community
mutate(COUSUB = substr(geoid, nchar(geoid)-5+1, nchar(geoid))) %>% #strip down geoid for merging
select(name, C17002001, C17002008, COUSUB) #pull only data used in EJ tool calculation
EJ_Def_Data$OBC_Poverty_Percent <- ((EJ_Def_Data$C17002001 - EJ_Def_Data$C17002008) / EJ_Def_Data$C17002001 * 100) #finds percent of population at 2x poverty rate
EJ_Def_Data$OBC_Poverty_Percent <- round(EJ_Def_Data$OBC_Poverty_Percent, 2)
## Crosswalk -----
Muni_Code_Crosswalk <- rename(Muni_Code_Crosswalk, COUSUB = MCD) # Rename header for other data
Muni_Code_Crosswalk <-
Muni_Code_Crosswalk %>%
filter(!is.na(CODE)) %>% # Removes Counties and CDPs
select("AREA NAME", COUSUB, CODE, CNTY)
# Merge Datasets -----
# Merges MRI, county unemployment, and poverty data into one table
Poverty_data <- full_join(Muni_Code_Crosswalk, MRI_data, by = "CODE") # merge MRI data with crosswalk table
Poverty_data <- full_join(Poverty_data, NJ_County_Unemp, by = "CNTY") # merge with county unemployment data
Poverty_data <- left_join(EJ_Def_Data, Poverty_data, by = "COUSUB")
# Calculate Criteria -----
Poverty_data <-
Poverty_data %>%
mutate(OBC_Poverty_Threshold = if_else(OBC_Poverty_Percent >= 35, "Meets or exceeds", "Does not meet")) %>%
mutate(Unemp_Threshold = if_else(Unemp_Diff >= 0, "Meets or exceeds", "Does not meet")) %>%
mutate(Population_Threshold = if_else(PopChange_Value <= NJ_State_Pop, "Meets or exceeds", "Does not meet")) %>%
mutate(MHI_Percent_State = MHI_Value / NJ_MHI * 100) %>% #Calculates the muni MHI as a percent of state MHI
mutate(MHI_Threshold = if_else((MHI_Value / NJ_MHI * 100) < 80, "Meets are exceeds", "Does not meet")) %>%
mutate(Current_Drinking = if_else((MHI_Value / NJ_MHI * 100) <= 65, "Qualifies", "Does not qualify")) %>% #Creates column using Drinking Water's calculation
mutate(Current_Clean = if_else(MHI_Value <= 90000 & Unemp_Value >= 5 & PopChange_Value <= 2, "Qualifies", "Does not qualify")) %>% #Creates column using Clean Water's threshold %>%
mutate(Score_Adjustment = case_when(
PopChange_Value <= NJ_State_Pop & Unemp_Diff >= 0 ~ "Score adjusted -2",
PopChange_Value <= NJ_State_Pop | Unemp_Diff >= 0 ~ "Score adjusted -1",
PopChange_Value > NJ_State_Pop & Unemp_Diff < 0 ~ "Score not adjusted")) %>%
mutate(Adjusted_Score = case_when(
PopChange_Value <= NJ_State_Pop & Unemp_Diff >= 0 ~ "-2",
PopChange_Value <= NJ_State_Pop | Unemp_Diff >= 0 ~ "-1",
PopChange_Value > NJ_State_Pop & Unemp_Diff < 0 ~ "0"))
Poverty_data <-
Poverty_data %>%
mutate(Adjusted_Score = round(MHI_Percent_State + as.numeric(Adjusted_Score),2))
# Removes extra columns and reorders the data by category
Poverty_Data_Final <-
Poverty_data %>%
select(
CODE, COUSUB, Muni, County, MRI_Rank, #general information about communities
OBC_Poverty_Percent, OBC_Poverty_Threshold, # % of population at or below 2x the poverty line, is % > 35
MHI_Value, MHI_Percent_State, MHI_Threshold, # MHI for muni, as a percent of state MHI, is it less than 90% of the state's value
ANN_AV_UNEMP_RATE, Unemp_Diff, Unemp_Threshold, # county unemployment rate, difference from state, is it worse than state
PopChange_Value, PopChange_Diff, Population_Threshold, # population change, is population staying the same or shrinking
Score_Adjustment, Adjusted_Score,
#OBC_Unemp_Pop, MHI_Unemp_Pop, All_Thresholds, #summary categories
Current_Drinking, Current_Clean #existing criteria
)
